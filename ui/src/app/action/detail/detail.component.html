<mat-sidenav-container class="example-sidenav-container"
    [style.marginTop.px]="mobileQuery.matches ? 56 : 0">

    <mat-sidenav opened id="left-panel" #snav
        [mode]="mobileQuery.matches ? 'over' : 'side'"
        [fixedInViewport]="mobileQuery.matches" fixedTopGap="56">
        <action-panel [projectId]="projectId"></action-panel>
    </mat-sidenav>

    <mat-sidenav-content id="action-content">
        <div fxLayout="row" class="action-info" *ngIf="action">
            <div class="action-icon">
                <mat-icon mat-list-icon *ngIf="action.status == 'FINISHED'">done</mat-icon>
                <mat-icon mat-list-icon *ngIf="action.status == 'SUCCESS'">done_all</mat-icon>
                <mat-icon mat-list-icon *ngIf="action.status == 'ERROR'">error</mat-icon>
                <mat-icon mat-list-icon *ngIf="action.status == 'RUNNING'">timelapse</mat-icon>
                <mat-icon mat-list-icon *ngIf="action.status == 'PENDING'">departure_board</mat-icon>
            </div>
            <div fxLayout="column">
                <div class="action-title">
                    <h2 class="mat-title">{{ action.name }}</h2>
                </div>
                <div class="mat-subheading-2 subtext" *ngIf="action.server">
                    <span *ngIf="action.status == 'RUNNING'">Running in </span>
                    <span *ngIf="['SUCCESS', 'ERROR'].indexOf(action.status) >= 0">Executed in </span>
                    <span *ngIf="action.status == 'PENDING'">It will run on </span>
                    {{ action.server.name }}
                </div>
            </div>

            <div fxFlex></div>

            <div fxFlexAlign="column" class="mat-typography">
                <div class="memory">
                    <mat-icon>memory</mat-icon>
                    Memory usage:
                    <span *ngIf="memoryPercent !== null">{{ memoryPercent|number: '1.0-2' }}%</span>
                    <span *ngIf="memoryPercent === null">?</span>
                </div>
            </div>

            <div fxLayout="column" class="mat-typography" style="margin-left: 20px;">
                <div class="date">
                    <mat-icon>scheduler</mat-icon>
                    Created {{ action.created_at | amTimeAgo }}
                </div>
                <div class="date" *ngIf="!action.completed_at">
                    <mat-icon>update</mat-icon>
                    Updated {{ action.updated_at | amTimeAgo }}
                </div>
                <div class="date" *ngIf="action.completed_at">
                    <mat-icon>done</mat-icon>
                    Complete {{ action.completed_at | amTimeAgo }}
                </div>
            </div>

            <div class="options">
                <button mat-icon-button [matMenuTriggerFor]="menu">
                    <mat-icon>more_vert</mat-icon>
                </button>
                <mat-menu #menu="matMenu">
                    <button mat-menu-item (click)="setEditMode();" *ngIf="mode != 'edit'">
                        <mat-icon>edit</mat-icon>
                        <span>Edit</span>
                    </button>
                    <button mat-menu-item (click)="deleteAction();" *ngIf="mode != 'edit'">
                        <mat-icon>delete</mat-icon>
                        <span>Delete</span>
                    </button>
                    <button mat-menu-item (click)="setDetailMode();" *ngIf="mode != 'detail'">
                        <mat-icon>visibility</mat-icon>
                        <span>Detail</span>
                    </button>
                </mat-menu>
            </div>

        </div>

        <mat-tab-group (selectedIndexChange)="getTab($event)" *ngIf="mode == 'detail' && action"
            [(selectedIndex)]="current">
            <mat-tab [disabled]="action.status != 'RUNNING'">
                <ng-template mat-tab-label>
                    <mat-icon class="tab-icon">branding_watermark</mat-icon>
                    Terminal
                </ng-template>
                <console *ngIf="action && action.terminal_url" [url]="action.terminal_url" #terminal
                    [auth]="action.terminal_auth"></console>
            </mat-tab>

            <mat-tab>
                <ng-template mat-tab-label>
                    <mat-icon class="tab-icon">local_movies</mat-icon>
                    Video
                </ng-template>
                <div id="asciinema">

                </div>
                <!-- <asciinema-player src="/api/projects/actions/4/asciinema.cast"></asciinema-player> -->
            </mat-tab>

            <mat-tab>
                <ng-template mat-tab-label>
                    <mat-icon class="tab-icon">description</mat-icon>
                    Output
                </ng-template>

                <console *ngIf="terminal_output" [data]="terminal_output"></console>
            </mat-tab>
        </mat-tab-group>
        <action-form [instanceId]="instanceId" *ngIf="mode == 'edit'" (onSave)="setDetailMode(true)"></action-form>
    </mat-sidenav-content>
</mat-sidenav-container>
