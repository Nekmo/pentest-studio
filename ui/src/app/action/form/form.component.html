
<form [formGroup]="form" (ngSubmit)="save(form.value)">
    <div class="form-container padding">
        <h2 class="mat-h2">Execute a command</h2>
        <mat-form-field appearance="outline">
            <mat-label>Action name</mat-label>
            <input matInput formControlName="name">
            <mat-hint>Name to identify this custom action</mat-hint>
        </mat-form-field>

        <mat-form-field appearance="fill" *ngIf="shortcut">
            <mat-label>Command</mat-label>
            <textarea matInput formControlName="command"></textarea>
            <mat-hint>Command to execute in this action</mat-hint>
        </mat-form-field>

        <mat-form-field>
            <mat-label>Worker</mat-label>
            <mat-select placeholder="Machine assigned to execute the task" formControlName="type" class="worker-status">
              <mat-option *ngFor="let worker of workers" [value]="worker">
                  <div style="display: flex"
                       [ngClass]="workerMetrics[worker.id]?.message.metric_data.state_color">
                      <span class="state-color"><mat-icon>fiber_manual_record</mat-icon></span>

                      {{ worker.name }} ({{ worker.id }})
                      <div fxFlex></div>
                      <span *ngIf="workerMetrics && workerMetrics[worker.id]" class="state-info">
                          <mat-icon>speed</mat-icon>
                          <span>{{ workerMetrics[worker.id]?.message.metric_data.cpu_usage_percent | number:'1.2-2' }}%</span>
                      </span>
                      <span *ngIf="workerMetrics && workerMetrics[worker.id]" class="state-info">
                          <mat-icon>sd_card</mat-icon>
                          <span>{{ workerMetrics[worker.id]?.message.metric_data.root_disk_usage_percent | number:'1.2-2' }}%</span>
                      </span>
                      <span *ngIf="workerMetrics && workerMetrics[worker.id]" class="state-info">
                          <mat-icon>memory</mat-icon>
                          <span>{{ workerMetrics[worker.id]?.message.metric_data.memory_usage_percent | number: '1.2-2' }}%</span>
                      </span>
                      <div style="margin-left: 16px">{{ worker.country }}</div>
                  </div>
              </mat-option>
            </mat-select>
        </mat-form-field>
    </div>

    <div class="padding">
        <button mat-button color="primary" type="submit">Save</button>
    </div>
</form>
