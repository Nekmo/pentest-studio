import {ApiService, Field, SerializerService} from "angular-django";
import {Injectable, Injector} from "@angular/core";
import {Dictionary} from "../../../../../angular-django/src/angular/projects/angular-django/src/lib/utility-types";
import {Observable} from "rxjs";

///////////////////////////////////////
// User API
///////////////////////////////////////

export class User extends SerializerService {
     @Field() pk: number;
     @Field() username: string;
}

@Injectable({
  providedIn: 'root'
})
export class UserApi extends ApiService {

    url = '/api/users/users/';
    serializer = User;
    contentType = 'auth_user';

  constructor(injector: Injector) {
    super(injector);
  }
}


///////////////////////////////////////
// Server API
///////////////////////////////////////
export class Server extends SerializerService {
     @Field() id: number;
     @Field() name: string;
     @Field() url: string;
     @Field() country: string;
     @Field() ip: string;
     @Field() pk: number;
}

@Injectable({
  providedIn: 'root'
})
export class ServerApi extends ApiService {

    url = '/api/workers/servers/';
    serializer = Server;
    contentType = 'pentest_worker_server';

  constructor(injector: Injector) {
    super(injector);
  }
}


///////////////////////////////////////
// Action API
///////////////////////////////////////
export class Action extends SerializerService {
     @Field() project: Project;
     @Field() name: string;
     @Field() parent: any;
     @Field() is_last: boolean;
     @Field() plugin: string;
     @Field() shortcut_id: string;
     @Field() command: string;
     @Field() status: string;
     @Field() task_id: string;
     @Field() server: Server;
     @Field() completed_at: Date;
     @Field() is_read: boolean;
     @Field() read_by: any;
     @Field() created_at: Date;
     @Field() updated_at: Date;
     @Field() id: number;
     @Field() pk: number;

     terminalOutput(): Observable<any> {
        return (this._api as ActionApi).terminalOutput(this.pk);
     }

}

@Injectable({
  providedIn: 'root'
})
export class ActionApi extends ApiService {

    url = '/api/projects/actions/';
    serializer = Action;
    contentType = 'projects_action';

  constructor(injector: Injector) {
      super(injector);
  }

  terminalOutput(pk: number): Observable<string> {
      return this.http.get(`${this.getUrlDetail(pk)}terminal_output/`, {responseType: 'text'});
  }
}


///////////////////////////////////////
// Project API
///////////////////////////////////////
export class Project extends SerializerService {
     @Field() name: string;
     @Field() type: string;
     @Field() parent: string;
     @Field() url: string;
     @Field() created_by: string;
     @Field() updated_by: string;
     @Field() created_at: Date;
     @Field() updated_at: Date;
     @Field() id: number;
     @Field() pk: number;
}

@Injectable({
  providedIn: 'root'
})
export class ProjectApi extends ApiService {

    url = '/api/projects/projects/';
    serializer = Project;
    contentType = 'projects_project';

  constructor(injector: Injector) {
    super(injector);
  }
}
