import django_filters

from pentest_project.models import Action


class ArrayFilter(django_filters.CharFilter):
    def __init__(self, field_name=None, lookup_expr='contains', *, label=None,
                 method=None, distinct=False, exclude=False, **kwargs):
        super().__init__(field_name=field_name, lookup_expr=lookup_expr, label=label,
                         method=method, distinct=distinct, exclude=exclude, **kwargs)

    def filter(self, qs, value):
        if value:
            value = value.split(',')
        else:
            value = []
        return super().filter(qs, value)


class ActionFilter(django_filters.FilterSet):
    status__in = ArrayFilter(field_name='status', lookup_expr='in')
    id__in = ArrayFilter(field_name='id', lookup_expr='in')

    class Meta:
        model = Action
        fields = ('parent', 'parent', 'project', 'status', 'created_at', 'updated_at')
