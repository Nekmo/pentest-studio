from django.db.models.signals import post_save
from django.dispatch import receiver

from pentest_project.models import Action


@receiver(post_save, sender=Action)
def update_is_last_action_plugin(sender, instance: Action, created: bool, **kwargs):
    if not created or not instance.plugin:
        return
    Action.objects\
        .filter(plugin=instance.plugin, is_last=True)\
        .exclude(pk=instance.pk).update(is_last=False)
