from .defaults import *


def get_docker_container_ip(container_name):
    from subprocess import check_output

    output = check_output(['docker', 'inspect',
                           '-f', '{{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}', container_name])

    return output.decode('utf-8').strip()


# This configuration allows to use postgres in docker and Django in the local machine
DATABASES['default']['HOST'] = get_docker_container_ip('pentest-studio_postgres_1')

CACHES['default']['LOCATION'] = 'redis://{}:6379/1'.format(get_docker_container_ip('pentest-studio_redis_1'))
CHANNEL_LAYERS['default']['CONFIG']['hosts'][0] = (get_docker_container_ip('pentest-studio_redis_1'), 6379)


CELERY_TASK_ALWAYS_EAGER = True
CELERY_TASK_EAGER_PROPAGATES = True
