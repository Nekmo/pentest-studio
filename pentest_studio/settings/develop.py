from .defaults import *


def get_docker_container_ip(container_name):
    from subprocess import check_output

    output = check_output(['docker', 'inspect',
                           '-f', '{{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}', container_name])

    return output.decode('utf-8').strip()


# This configuration allows to use postgres in docker and Django in the local machine
DATABASES['default']['HOST'] = get_docker_container_ip('pentest-studio_postgres_1')

CACHES = {
    'default': {
        'BACKEND': 'redis_cache.RedisCache',
        'LOCATION': 'redis://{}:6379/1'.format(get_docker_container_ip('pentest-studio_redis_1')),
        'TIMEOUT': 60 * 60 * 24 * 2,
        'OPTIONS': {
            'DB': 0,
            'MAX_ENTRIES': 50000,
            "CLIENT_CLASS": "django_redis.client.DefaultClient",
            "IGNORE_EXCEPTIONS": True,
        }
    },
}
